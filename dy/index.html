<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <!-- iOS ç›¸å…³metaæ ‡ç­¾ -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-title" content="éšæœºèˆè¹ˆ">
        <!-- æ·»åŠ åˆ°ä¸»å±å¹•çš„å›¾æ ‡ -->
        <link rel="apple-touch-icon" href="icon-180.png">
        <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
        <link rel="apple-touch-icon" sizes="167x167" href="icon-167.png">
        <!-- å¯åŠ¨ç”»é¢ -->
        <link rel="apple-touch-startup-image" href="launch.png">
        <title>éšæœºèˆè¹ˆè§†é¢‘</title>
        <style>
</style>
    </head>
    
    <body>
        <div class="container">
            <div class="video-container">
                <video id="danceVideo" controls>æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚</video>
            </div>
            <div class="controls">
                <button class="next-button" onclick="nextVideo()">ä¸‹ä¸€ä¸ª</button>
                <button class="refresh-button" onclick="refreshVideo()">åˆ·æ–°</button>
                <button class="play-toggle-button" onclick="togglePlay()">æš‚åœ/æ’­æ”¾</button>
                <button class="like-button" onclick="createHearts()">ç‚¹èµ</button>
                <button class="pip-button" onclick="togglePip()">ç”»ä¸­ç”»</button>
            </div>
            <div class="alert" id="alertBox">å¤åˆ¶æˆåŠŸï¼Œè¯·æ‰“å¼€æµè§ˆå™¨è¿›è¡Œä¸‹è½½ä¿å­˜ï¼</div>
            <div class="copyright"><a href="https://www.dadawz.cn/" id="copyrightLink">Â© 2024 å¤§å¤§-éšæœºèˆè¹ˆ. ä¿ç•™æ‰€æœ‰æƒåˆ©.</a>
            </div>
            <!-- å¤§å¤§åšå®¢ https://www.dadawz.cn/-->
        </div>
        <script>
            /**
             * @type {HTMLVideoElement}
             */
            const video = document.getElementById('danceVideo');

            /**
             * è§†é¢‘æºæ•°ç»„ - å¯ä»¥æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„APIæˆ–è§†é¢‘æº
             * @type {string[]}
             */
            const videoSources = [
                'https://api.yviii.com/video/suiji.php',
                'https://api.yviii.com/video/i.php',
                'http://api.mhycloud.fun:81/api/dy',
            ];

            /**
             * è·å–éšæœºè§†é¢‘æº
             * @returns {string} éšæœºè§†é¢‘URL
             */
            function getRandomVideo() {
                const randomIndex = Math.floor(Math.random() * videoSources.length);
                return videoSources[randomIndex];
            }

            /**
             * æ·»åŠ åŠ è½½çŠ¶æ€å¤„ç†
             */
            function setLoading(isLoading) {
                const video = document.getElementById('danceVideo');
                if (isLoading) {
                    video.classList.add('loading');
                } else {
                    video.classList.remove('loading');
                }
            }

            /**
             * å¢å¼ºç‰ˆçš„ä¸‹ä¸€ä¸ªè§†é¢‘å‡½æ•°
             */
            async function nextVideo() {
                setLoading(true);
                const newSrc = getRandomVideo();
                // ç¡®ä¿ä¸ä¼šè¿ç»­æ’­æ”¾åŒä¸€ä¸ªè§†é¢‘
                if (newSrc === video.src) {
                    return nextVideo();
                }
                video.src = newSrc;
                try {
                    await video.play();
                } catch (error) {
                    console.error('è§†é¢‘æ’­æ”¾å¤±è´¥:', error);
                }
                video.oncanplay = () => {
                    setLoading(false);
                };
            }

            /**
             * åˆ·æ–°å½“å‰è§†é¢‘
             */
            function refreshVideo() {
                video.currentTime = 0;
                video.play();
            }

            /**
             * åˆ‡æ¢è§†é¢‘æ’­æ”¾/æš‚åœçŠ¶æ€
             */
            function togglePlay() {
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
            }

            /**
             * åˆ›å»ºçˆ±å¿ƒåŠ¨ç”»æ•ˆæœ
             */
            function createHearts() {
                for (let i = 0; i < 15; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('div');
                        heart.innerHTML = ['â¤ï¸', 'â­', 'âœ¨', 'ğŸ’–', 'ğŸ’•'][Math.floor(Math.random() * 5)];
                        heart.className = 'floating-heart';
                        heart.style.left = Math.random() * window.innerWidth + 'px';
                        heart.style.fontSize = (20 + Math.random() * 20) + 'px';
                        document.body.appendChild(heart);

                        setTimeout(() => {
                            heart.remove();
                        }, 3000);
                    }, i * 100);
                }
            }

            /**
             * åˆ‡æ¢ç”»ä¸­ç”»æ¨¡å¼
             */
            function togglePip() {
                if (document.pictureInPictureElement) {
                    document.exitPictureInPicture().catch(error => {
                        console.error('é€€å‡ºç”»ä¸­ç”»å¤±è´¥:', error);
                    });
                } else {
                    video.requestPictureInPicture().catch(error => {
                        console.error('è¿›å…¥ç”»ä¸­ç”»å¤±è´¥:', error);
                    });
                }
            }

            // ç¦ç”¨åŒæŒ‡ç¼©æ”¾
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });

            // å¤„ç†iOSçš„å„ç§æ‰‹åŠ¿
            let touchStartY = 0;
            document.addEventListener('touchstart', function(e) {
                touchStartY = e.touches[0].clientY;
            }, {
                passive: false
            });

            document.addEventListener('touchmove', function(e) {
                const touchY = e.touches[0].clientY;
                const delta = touchStartY - touchY;

                // å¦‚æœä¸æ˜¯åœ¨è§†é¢‘ä¸Šæ»‘åŠ¨ï¼Œåˆ™é˜»æ­¢é»˜è®¤è¡Œä¸º
                if (!e.target.matches('video')) {
                    e.preventDefault();
                }
            }, {
                passive: false
            });

            // æ·»åŠ iOSçš„é”™è¯¯å¤„ç†
            video.addEventListener('error', function(e) {
                console.error('è§†é¢‘åŠ è½½é”™è¯¯:', e.target.error);
                nextVideo();
            });

            // å¤„ç†iOSåå°æ’­æ”¾
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    video.pause();
                }
            });

            // åˆå§‹åŒ–
            window.onload = function() {
                nextVideo();
                video.addEventListener('ended', nextVideo); // æ’­æ”¾å®Œè‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€ä¸ª
            };
        </script>
    </body>

</html>
